var e;const t=new((e=class{deepCopy(e){return e.map(e=>e.slice())}constructor(e){this.board=e?this.deepCopy(e):this.deepCopy([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),this.initialBoardState=this.deepCopy(this.board),this.score=0,this.status="idle",this.isStarted=!1}generateNewTile(){let e=[];for(let t=0;t<4;t++)for(let s=0;s<4;s++)0===this.board[t][s]&&e.push({row:t,col:s});if(0===e.length)return!1;let t=Math.floor(Math.random()*e.length),{row:s,col:r}=e[t],i=.1>Math.random()?4:2;return this.board[s][r]=i,!0}processLine(e){let t=0,s=e.filter(e=>0!==e);for(let e=0;e<s.length-1;e++)s[e]===s[e+1]&&(s[e]*=2,t+=s[e],s[e+1]=0);for(s=s.filter(e=>0!==e);s.length<4;)s.push(0);return{newLine:s,scoreChange:t}}transposeBoard(e){let t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];for(let s=0;s<4;s++)for(let r=0;r<4;r++)t[s][r]=e[r][s];return t}checkWin(){for(let e=0;e<4;e++)for(let t=0;t<4;t++)if(2048===this.board[e][t])return this.status="win",!0;return!1}hasAvailableMoves(){for(let e=0;e<4;e++)for(let t=0;t<4;t++){if(0===this.board[e][t])return!0;let s=this.board[e][t];if(t<3&&this.board[e][t+1]===s||e<3&&this.board[e+1][t]===s)return!0}return!1}checkGameStatus(){this.checkWin()||this.hasAvailableMoves()||(this.status="lose")}moveLeft(){if("playing"!==this.status)return!1;let e=this.deepCopy(this.board),t=!1;for(let s=0;s<4;s++){let{newLine:r,scoreChange:i}=this.processLine(this.board[s]);this.score+=i,e[s].join(",")!==r.join(",")&&(t=!0),this.board[s]=r}return!!t&&(this.generateNewTile(),this.checkGameStatus(),!0)}moveRight(){if("playing"!==this.status)return!1;let e=this.deepCopy(this.board),t=!1;for(let s=0;s<4;s++){let r=this.board[s];r.reverse();let{newLine:i,scoreChange:a}=this.processLine(r);this.score+=a,i.reverse(),e[s].join(",")!==i.join(",")&&(t=!0),this.board[s]=i}return!!t&&(this.generateNewTile(),this.checkGameStatus(),!0)}moveUp(){if("playing"!==this.status)return!1;let e=this.deepCopy(this.board),t=!1;this.board=this.transposeBoard(this.board);for(let e=0;e<4;e++){let{newLine:t,scoreChange:s}=this.processLine(this.board[e]);this.score+=s,this.board[e]=t}this.board=this.transposeBoard(this.board);for(let s=0;s<4;s++)if(e[s].join(",")!==this.board[s].join(",")){t=!0;break}return!!t&&(this.generateNewTile(),this.checkGameStatus(),!0)}moveDown(){if("playing"!==this.status)return!1;let e=this.deepCopy(this.board),t=!1;this.board=this.transposeBoard(this.board);for(let e=0;e<4;e++){let t=this.board[e];t.reverse();let{newLine:s,scoreChange:r}=this.processLine(t);this.score+=r,s.reverse(),this.board[e]=s}this.board=this.transposeBoard(this.board);for(let s=0;s<4;s++)if(e[s].join(",")!==this.board[s].join(",")){t=!0;break}return!!t&&(this.generateNewTile(),this.checkGameStatus(),!0)}getScore(){return this.score}getState(){return this.board}getStatus(){return this.status}start(){this.generateNewTile(),this.generateNewTile(),this.status="playing",this.isStarted=!0}restart(){this.board=this.initialBoardState.map(e=>e.slice()),this.score=0,this.status="idle",this.start()}}).__esModule?e.default:e),s=document.querySelector(".game-field"),r=document.querySelector(".game-score"),i=document.querySelector(".button"),a=document.querySelector(".message-start"),o=document.querySelector(".message-lose"),n=document.querySelector(".message-win");function h(){!function(){let e=t.getState();s.querySelectorAll(".field-cell").forEach((t,s)=>{let r=Math.floor(s/4),i=s%4;if(!e[r]||void 0===e[r][i])return;let a=e[r][i];t.textContent=0===a?"":a,t.className="field-cell",0!==a&&t.classList.add(`field-cell--${a}`)})}(),r.textContent=t.getScore(),function(){let e=t.getStatus();t.isStarted?(i.textContent="Restart",i.classList.remove("start"),i.classList.add("restart")):(i.textContent="Start",i.classList.add("start"),i.classList.remove("restart")),a.classList.add("hidden"),o.classList.add("hidden"),n.classList.add("hidden"),"win"===e?n.classList.remove("hidden"):"lose"===e?o.classList.remove("hidden"):"idle"===e&&a.classList.remove("hidden")}()}i&&s&&r&&(i.addEventListener("click",function(){"playing"===t.getStatus()||t.isStarted?t.restart():t.start(),h()}),document.addEventListener("keydown",function(e){if("playing"!==t.getStatus())return;let s=!1;switch(e.key){case"ArrowLeft":s=t.moveLeft();break;case"ArrowRight":s=t.moveRight();break;case"ArrowUp":s=t.moveUp();break;case"ArrowDown":s=t.moveDown();break;default:return}s&&(e.preventDefault(),h())}),h());
//# sourceMappingURL=index.b21eed7d.js.map
